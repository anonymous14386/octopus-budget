<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: #f5f7fa; }
        nav { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        nav .container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        nav h1 { font-size: 24px; }
        nav .nav-links { display: flex; gap: 20px; flex-wrap: wrap; }
        nav a { color: white; text-decoration: none; padding: 8px 16px; border-radius: 5px; transition: background 0.3s; }
        nav a:hover { background: rgba(255,255,255,0.2); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .summary-card h3 { color: #555; font-size: 14px; margin-bottom: 10px; text-transform: uppercase; }
        .summary-card .amount { font-size: 32px; font-weight: bold; color: #667eea; }
        .summary-card.debt .amount { color: #dc3545; }
        .summary-card.income .amount { color: #28a745; }
        .stat-label { color: #888; font-size: 12px; margin-top: 5px; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #333; margin-bottom: 20px; font-size: 22px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-weight: 600; color: #555; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 5px; color: #555; font-weight: 500; font-size: 14px; }
        input, select { padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        button, .btn { padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600; transition: transform 0.2s; text-decoration: none; display: inline-block; }
        button:hover, .btn:hover { transform: translateY(-2px); }
        .delete-btn { background: #ffc9c9; color: #000; padding: 6px 12px; font-size: 12px; text-decoration: none; border-radius: 4px; }
        .delete-btn:hover { background: #ffb3b3; }
        .edit-btn { background: #fff3cd; color: #000; padding: 6px 12px; font-size: 12px; margin-right: 5px; text-decoration: none; border-radius: 4px; }
        .edit-btn:hover { background: #ffe69c; }
        .actions { display: flex; gap: 5px; }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <h1>üí∞ Budget Tracker</h1>
            <div class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/settings">Settings</a>
                <a href="/logout">Logout (<%= user.username %>)</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin: 30px 0 20px; color: #333;">Welcome, <%= user.username %>!</h1>

        <div class="summary-grid">
            <div class="summary-card debt">
                <h3>üí≥ Total Debt</h3>
                <% let totalOwed = 0; %>
                <% debts.forEach(debt => { totalOwed += debt.balance; }); %>
                <div class="amount">$<%= totalOwed.toFixed(2) %></div>
            </div>
            <div class="summary-card income">
                <h3>üíµ Monthly Income</h3>
                <% let monthlyIncome = 0; %>
                <% income.forEach(item => { 
                    if (item.frequency === 'weekly') monthlyIncome += item.amount * 4.33;
                    else if (item.frequency === 'biweekly') monthlyIncome += item.amount * 2.166667;
                    else monthlyIncome += item.amount;
                }); %>
                <div class="amount">$<%= monthlyIncome.toFixed(2) %></div>
            </div>
            <div class="summary-card">
                <h3>üè¶ Total in Accounts</h3>
                <% let totalBalance = 0; %>
                <% accounts.forEach(account => { totalBalance += account.balance; }); %>
                <div class="amount">$<%= totalBalance.toFixed(2) %></div>
            </div>
            <div class="summary-card">
                <h3>üìä Subscription Total</h3>
                <% let subscriptionTotal = 0; %>
                <% subscriptions.forEach(sub => { 
                    let amount = sub.amount;
                    if (sub.frequency === 'daily') amount *= 30;
                    else if (sub.frequency === 'weekly') amount *= 4.33;
                    else if (sub.frequency === 'yearly') amount /= 12;
                    subscriptionTotal += amount;
                }); %>
                <div class="amount">$<%= subscriptionTotal.toFixed(2) %></div>
                <div class="stat-label"><%= subscriptions.length %> subscriptions/month</div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px;">
            <!-- Subscriptions -->
            <!-- Subscriptions -->
            <div class="card">
                <h2>üì∫ Subscriptions</h2>
                <% if (subscriptions.length > 0) { %>
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Amount</th>
                        <th>Frequency</th>
                        <th>Actions</th>
                    </tr>
                    <% subscriptions.forEach(subscription => { %>
                        <tr>
                            <td><%= subscription.name %></td>
                            <td>$<%= subscription.amount.toFixed(2) %></td>
                            <td><%= subscription.frequency %></td>
                            <td class="actions">
                                <a href="/subscriptions/edit/<%= subscription.id %>" class="edit-btn">Edit</a>
                                <a href="/subscriptions/delete/<%= subscription.id %>" class="delete-btn" onclick="return confirm('Delete this subscription?')">Delete</a>
                            </td>
                        </tr>
                    <% }); %>
                </table>
                <% } else { %>
                    <p style="text-align: center; color: #888; padding: 20px;">No subscriptions yet</p>
                <% } %>
                <h3 style="font-size: 16px; margin-bottom: 15px;">Add Subscription</h3>
                <form action="/subscriptions" method="post">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" step="0.01" name="amount" required>
                        </div>
                        <div class="form-group">
                            <label>Frequency</label>
                            <select name="frequency">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit">Add Subscription</button>
                </form>
            </div>

            <!-- Accounts -->
            <div class="card">
                <h2>üè¶ Accounts</h2>
                <% if (accounts.length > 0) { %>
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Balance</th>
                        <th>Actions</th>
                    </tr>
                    <% accounts.forEach(account => { %>
                        <tr>
                            <td><%= account.name %></td>
                            <td>$<%= account.balance.toFixed(2) %></td>
                            <td>
                                <a href="/accounts/delete/<%= account.id %>" class="delete-btn" onclick="return confirm('Delete this account?')">Delete</a>
                            </td>
                        </tr>
                    <% }); %>
                </table>
                <% } else { %>
                    <p style="text-align: center; color: #888; padding: 20px;">No accounts yet</p>
                <% } %>
                <h3 style="font-size: 16px; margin-bottom: 15px;">Add/Update Account</h3>
                <form action="/accounts" method="post">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Balance</label>
                            <input type="number" step="0.01" name="balance" required>
                        </div>
                    </div>
                    <button type="submit">Add/Update</button>
                </form>
            </div>

            <!-- Income -->
            <div class="card">
                <h2>üíµ Income</h2>
                <% if (income.length > 0) { %>
                <table>
                    <tr>
                        <th>Amount</th>
                        <th>Frequency</th>
                    </tr>
                    <% income.forEach(item => { %>
                        <tr>
                            <td>$<%= item.amount.toFixed(2) %></td>
                            <td><%= item.frequency %></td>
                        </tr>
                    <% }); %>
                </table>
                <% } else { %>
                    <p style="text-align: center; color: #888; padding: 20px;">No income entries yet</p>
                <% } %>
                <h3 style="font-size: 16px; margin-bottom: 15px;">Add/Update Income</h3>
                <form action="/income" method="post">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" step="0.01" name="amount" required>
                        </div>
                        <div class="form-group">
                            <label>Frequency</label>
                            <select name="frequency">
                                <option value="weekly">Weekly</option>
                                <option value="biweekly">Bi-weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit">Add/Update</button>
                </form>
            </div>

            <!-- Debts -->
            <div class="card">
                <h2>üí≥ Debts</h2>
                <% if (debts.length > 0) { %>
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Balance</th>
                        <th>Actions</th>
                    </tr>
                    <% debts.forEach(debt => { %>
                        <tr>
                            <td><%= debt.name %></td>
                            <td>$<%= debt.balance !== null && debt.balance !== undefined ? debt.balance.toFixed(2) : '0.00' %></td>
                            <td>
                                <a href="/debts/delete/<%= debt.id %>" class="delete-btn" onclick="return confirm('Delete this debt?')">Delete</a>
                            </td>
                        </tr>
                    <% }); %>
                </table>
                <% } else { %>
                    <p style="text-align: center; color: #888; padding: 20px;">No debts yet</p>
                <% } %>
                <h3 style="font-size: 16px; margin-bottom: 15px;">Add/Update Debt</h3>
                <form action="/debts" method="post">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Debt Name</label>
                            <input type="text" name="name" placeholder="e.g., Credit Card, Loan, etc." required>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" step="0.01" name="amount" required>
                        </div>
                    </div>
                    <button type="submit">Add/Update</button>
                </form>
            </div>
        </div>
    </div>
</body>
</html>